<html dir="rtl" class="coil js csstransitions" lang="he" geo="IL">
    <head>
    <!-- css -->
    <link rel="stylesheet" href="https://i-invdn-com.akamaized.net/css/newMainCssRtlMin_v65c.css" type="text/css">

    <style type="text/css">
.totalGreen {background-color: #34a853!important;color:#fff;}
.tblDiv {padding-bottom: 20px;}
.gold {background-color: #fbbc04;}
.purple {background-color: #D8BFD8;}
.darkPurple {background-color: #DDA0DD;}
.table td { text-align: center; vertical-align: middle;}
.table th { text-align: center; vertical-align: middle;}
</style>
<!-- css -->
<!-- js -->
<script src="https://i-invdn-com.akamaized.net/js/jquery-6.4.9.04.min.js"></script>      
    <script type="text/javascript" src="https://i-invdn-com.akamaized.net/js/main-1.17.256.min.js"></script>
    </head>
    <meta charset="utf-8">
    <body class="takeover dfpTakeovers " data-gr-c-s-loaded="true" cz-shortcut-listen="true">
    <div style="padding-left: 40px;padding-right: 40px;">
    <div class="tblDiv">
    <table tablesorter_overview="" rel="11298994" id="myTable" class="js-table-sortable genTbl openTbl js-portfolio-tbl myPortfolioTbl table" data-numofrows="6">
    <thead>
    <tr>
    <th class="" data-column-name="name">שם</th>
    <th class="" data-column-name="name">שער קניה</th>
<th class="" data-column-name="last">שער נוכחי</th>
<th class="" data-column-name="last">כמות</th>
    <th class="" data-column-name="last">שווי בקניה</th>
<th class="" data-column-name="last">שווי נוכחי</th>
<th class="" data-column-name="last">אחוז שינוי</th>
<th class="" data-column-name="last">שער מדד בקניה</th>
<th class="" data-column-name="last">שער מדד נוכחי</th>
<th class="" data-column-name="last">אחוז שינוי בשער</th>
<th class="" data-column-name="last">אחוז שינוי בשער X3</th>
<th class="" data-column-name="last">הפרש באחוזים</th>
<th class="" data-column-name="last">הפרש בשווי</th>
</tr>
</thead>
<tbody id="tbody_overview" class="ui-sortable">
    <tr id="sort_1" rel="11298994_166" data-pair-id="166" data-pair-exchange-id="1" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true"  title="US500">S&P</a></td>
<td contenteditable="true" >0</td>
    <td contenteditable="true" id="current_sp_val">--</td>
    <td contenteditable="true" >0</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >0</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>

    </tr>
    <tr id="sort_2" rel="11298994_20" data-pair-id="20" data-pair-exchange-id="2" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" title="NDX">NASDAQ</a></td>
<td contenteditable="true" >95612</td>
    <td contenteditable="true" id="current_ndx_val">--</td>
    <td contenteditable="true" >410</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >12420</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    </tr>
    <tr id="sort_3" rel="11298994_172" data-pair-id="172" data-pair-exchange-id="4" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" title="DE30">DAX</a></td>
<td contenteditable="true" >0</td>
    <td contenteditable="true" id="current_dax_val">--</td>
    <td contenteditable="true" >0</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >0</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    </tr>  
    <tr id="sort_4" rel="11298994_172" data-pair-id="172" data-pair-exchange-id="4" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" title="total">TOTAL</a></td>
<td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    </tr>  
    </tr>  
    <tr id="sort_5" rel="11298994_172" data-pair-id="172" data-pair-exchange-id="4" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" title=""></a></td>
<td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" class ="gold" style="font-weight: 900; font-size: 15px;"></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    </tr>                
    </tbody>
    </table>
    </div>

    <div class="tblDiv">
    <table tablesorter_overview="" rel="11298994" id="myTable2" class="genTbl table" data-numofrows="2">
    <thead>
    <tr>
    <th class="" data-column-name="name">שם מדד</th>
<th class="" data-column-name="name">שער מדד נוכחי</th>
<th class="" data-column-name="last">שער מדד עתידי</th>
<th class="darkPurple" data-column-name="last">שערי מדדים בשעת סגירה</th>
<th class="darkPurple" data-column-name="last">שערי קרן היסטורים לחישוב</th>
<th class="" data-column-name="last">שערים בחסר</th>
<th class="" data-column-name="last">נוסף</th>
    </tr>
    </thead>
    <tbody id="tbody_overview" class="ui-sortable">
    <tr id="sort_1" rel="11298994_166" data-pair-id="166" data-pair-exchange-id="1" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true"  title="US500">S&P</a></td>
<td contenteditable="true" id="cur_sp_index">--</td>
    <td contenteditable="true" id="fut_sp_index">--</td>
    <td contenteditable="true" class="purple" id="close_sp" >4070</td>
    <td contenteditable="true" class="purple" id="his_sp_rate">28230</td>
    <td contenteditable="true" >168.9</td>
    <td contenteditable="true" >0</td>
    </tr>
    <tr id="sort_2" rel="11298994_20" data-pair-id="20" data-pair-exchange-id="2" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" title="NDX">NASDAQ</a></td>
<td contenteditable="true" id="cur_ndx_index">--</td>
    <td contenteditable="true" id="fut_ndx_index">--</td>
    <td contenteditable="true" class="purple" id="close_ndx">13778</td>
    <td contenteditable="true" class="purple" id="his_ndx_rate">119900</td>
    <td contenteditable="true" >27.7</td>
    <td contenteditable="true" >0</td>
    </tr>
    <tr id="sort_3" rel="11298994_172" data-pair-id="172" data-pair-exchange-id="4" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" title="DE30">DAX</a></td>
<td contenteditable="true" id="cur_dax_index">--</td>
    <td contenteditable="true" id="fut_dax_index">--</td>
    <td contenteditable="true" class="purple" id="close_dax">15195</td>
    <td contenteditable="true" class="purple" id="his_dax_rate">4655</td>
    <td contenteditable="true" >275</td>
    <td contenteditable="true" >0</td>
    </tr>  

    </tbody>
    </table>
    </div>
    <div class="tblDiv">
    <table tablesorter_overview="" rel="11298994" id="myTable3" class="genTbl table" data-numofrows="2">
    <thead>
    <tr>
    <th class="" data-column-name="name">שם מדד</th>
<th class="" data-column-name="name">ערך קרן צפוי</th>
<th class="" data-column-name="name">שווי צפוי כולל</th>
<th class="" data-column-name="last">אחוז שינוי משוערך</th>
<th class="" data-column-name="last">שווי שינוי מוערך</th>
<th class="" data-column-name="last">אחוז שינוי כולל</th>
<th class="" data-column-name="last">ערך קרן בפועל</th>
<th class="" data-column-name="last">שווי בפועל</th>
<th class="" data-column-name="last">שוני מההערכה</th>
</tr>
</thead>
<tbody id="tbody_overview" class="ui-sortable">
    <tr id="sort_1" rel="11298994_166" data-pair-id="166" data-pair-exchange-id="1" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true"  title="US500">S&P</a></td>
<td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" class="">28320</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    </tr>
    <tr id="sort_2" rel="11298994_20" data-pair-id="20" data-pair-exchange-id="2" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" title="NDX">NASDAQ</a></td>
<td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" class="">120960</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    </tr>
    <tr id="sort_3" rel="11298994_172" data-pair-id="172" data-pair-exchange-id="4" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" title="DE30">DAX</a></td>
<td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" class="">4645</td>
    <td contenteditable="true" >--</td>
    <td contenteditable="true" >--</td>
    </tr> 

    <tr id="sort_4" rel="11298994_172" data-pair-id="172" data-pair-exchange-id="4" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" title="total">TOTAL</a></td>
<td contenteditable="true" class="gold" style="font-weight: 900; font-size: 15px;"></td>
    <td contenteditable="true" class="totalGreen"></td>
    <td contenteditable="true" >extra:</td>
<td contenteditable="true" id="extraMoney">4980</td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    <td contenteditable="true" ></td>
    </tr>  

    </tbody>
    </table>
    </div>


    </div>
    <div style="margin-right: 25px;">
    <button type="button" onclick="setMyInterval(3000000)">STOP interval</button>
<button style="margin: 0 15px;"type="button" type="button" onclick="setMyInterval(1000)">1s interval</button>
<button style="margin-left: 15px;" type="button"  onclick="setMyInterval(5000)">5s interval</button>
<button onclick="setMyInterval(30000)">30s interval</button>
<button style="margin-right: 80px;"onclick="clearCacheHistoricRate()">Clear cache historic rate</button>
<button style="margin-right: 80px;"onclick="setUseMyValues(true)">Use My Values</button>

<br>
<div style="padding-top: 15px;">
    <span style="font-size: 14; font-weight: 500;margin-right: 125px"> <span id="intervalValue" style="font-size: 20; font-weight: 900;margin-right: 5px;">30</span>Seconds Interval</span>
</div>






</div>



<section id="fullColumn" class="ui-sortable">
    <div class="js-watchlist-content">
    <table style="margin-right: 30px; width: fit-content;" id = t1 tablesorter_overview="" rel="11298994" class="js-table-sortable genTbl openTbl js-portfolio-tbl myPortfolioTbl " data-numofrows="6">
    <thead>
    <tr>
    <th class="" data-column-name="name">שם</th>
    <th class="" data-column-name="last">שער אחרון</th>
<th class="" data-column-name="last">אחוז שינוי</th>
</tr>
</thead>
<tbody id="tbody_overview_11298994" class="ui-sortable">
    <tr id="sort_166" rel="11298994_166" data-pair-id="166" data-pair-exchange-id="1" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" data-column-name="symbol" class="left bold "><a target="_blank" href="/indices/us-spx-500" title="US500">S&P</a></td>
<td contenteditable="true" data-column-name="last" class="pid-166-last " id="11298994_last_166">--</td>
    <td contenteditable="true" data-column-name="chgpercent" class="bold pid-166-pcp greenFont" id="11298994_p_chg_166">--</td>
    </tr>
    <tr id="sort_20" rel="11298994_20" data-pair-id="20" data-pair-exchange-id="2" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" data-column-name="symbol" class="left bold "><a target="_blank" href="/indices/nq-100" title="NDX">NASDAQ</a></td>
<td contenteditable="true" data-column-name="last" class="pid-20-last " id="11298994_last_20">--</td>
    <td contenteditable="true" data-column-name="chgpercent" class="bold pid-20-pcp greenFont" id="11298994_p_chg_20">--</td>
    </tr>
    <tr id="sort_172" rel="11298994_172" data-pair-id="172" data-pair-exchange-id="4" data-is-open-by="exchange" data-is-pair-exchange-open="1">
    <td contenteditable="true" data-column-name="symbol" class="left bold "><a target="_blank" href="/indices/germany-30" title="DE30">DAX</a></td>
<td contenteditable="true" data-column-name="last" class="pid-172-last " id="11298994_last_172">--</td>
    <td contenteditable="true" data-column-name="chgpercent" class="bold pid-172-pcp greenFont" id="11298994_p_chg_172">--</td>
    </tr>
    <tr id="sort_8839" rel="11298994_8839" data-pair-id="8839" data-pair-exchange-id="1004" data-is-open-by="pair" data-is-pair-exchange-open="1">
    <td contenteditable="true" data-column-name="symbol" class="left bold "><a target="_blank" href="/indices/us-spx-500-futures" title="US500">S&P Future</a></td>
<td contenteditable="true" data-column-name="last" class="pid-8839-last redBg" id="11298994_last_8839">--</td>
    <td contenteditable="true" data-column-name="chgpercent" class="bold pid-8839-pcp greenFont" id="11298994_p_chg_8839">--</td>
    </tr>
    <tr id="sort_8874" rel="11298994_8874" data-pair-id="8874" data-pair-exchange-id="1004" data-is-open-by="pair" data-is-pair-exchange-open="1">
    <td contenteditable="true" data-column-name="symbol" class="left bold "><a target="_blank" href="/indices/nq-100-futures" title="USTEC">NASDAQ Future</a></td>
<td contenteditable="true" data-column-name="last" class="pid-8874-last" id="11298994_last_8874">--</td>
    <td contenteditable="true" data-column-name="chgpercent" class="bold pid-8874-pcp greenFont" id="11298994_p_chg_8874">--</td>
    </tr>
    <tr id="sort_8826" rel="11298994_8826" data-pair-id="8826" data-pair-exchange-id="1004" data-is-open-by="pair" data-is-pair-exchange-open="1">
    <td contenteditable="true" data-column-name="symbol" class="left bold "><a target="_blank" href="/indices/germany-30-futures" title="DE30">DAX Fututre</a></td>
<td contenteditable="true" data-column-name="last" class="pid-8826-last" id="11298994_last_8826">--</td>
    <td contenteditable="true" data-column-name="chgpercent" class="bold pid-8826-pcp greenFont" id="11298994_p_chg_8826">--</td>
    </tr>
    <tr id="sort_1116194" rel="11299060_1116194" data-pair-id="1116194" data-pair-exchange-id="5" data-is-open-by="pair" data-is-pair-exchange-open="1">
    <td contenteditable="true" data-column-name="symbol" class="left bold "><a target="_blank" href="" title="KSMF111">S&P X3</a></td>
<td contenteditable="true" data-column-name="last" class="pid-1116194-last" id="11299060_last_1116194">--</td>
    <td contenteditable="true" data-column-name="chgpercent" class="bold pid-1116194-pcp greenFont" id="11299060_p_chg_1116194">--</td>
    </tr>
    <tr id="sort_1116195" rel="11299060_1116195" data-pair-id="1116195" data-pair-exchange-id="5" data-is-open-by="pair" data-is-pair-exchange-open="1">
    <td contenteditable="true" data-column-name="symbol" class="left bold "><a target="_blank" href="" title="KSMF112">NASDAQ X3</a></td>
<td contenteditable="true" data-column-name="last" class="pid-1116195-last" id="11299060_last_1116195">--</td>
    <td contenteditable="true" data-column-name="chgpercent" class="bold pid-1116195-pcp greenFont" id="11299060_p_chg_1116195">--</td>
    </tr>
    <tr id="sort_1116196" rel="11299060_1116196" data-pair-id="1116196" data-pair-exchange-id="5" data-is-open-by="pair" data-is-pair-exchange-open="1">
    <td contenteditable="true" data-column-name="symbol" class="left bold "><a target="_blank" href="" title="KSMF113">DAX X3</a></td>
<td contenteditable="true" data-column-name="last" class="pid-1116196-last" id="11299060_last_1116196">--</td>
    <td contenteditable="true" data-column-name="chgpercent" class="bold pid-1116196-pcp greenFont" id="11299060_p_chg_1116196">--</td>
    </tr>
    </tbody>
    </table>
    </div>
    </section>
    <!-- /leftColumn -->

    <script>
//["{\"_event\":\"bulk-subscribe\",\"tzID\":17,\"message\":\"pid-166:%%pid-20:%%pid-172:%%pid-8839:%%pid-8874:%%pid-8826:\"}"]
//["{"_event":"bulk-subscribe","tzID":17,"message":"pid-166:%%pid-20:%%pid-172:%%pid-8839:%%pid-8874:%%pid-8826:"}"]
var useMyValues = false;
var initiated = false;
var interval;
var intervalValue=30;
var total=[0,0,0,0,0,0];
var extra = 4980;
var liveData = ["--","--","--","--","--","--","--","--","--"];

setToLocalStorageInitial('currentRateData',3);
setToLocalStorageInitial('closeRateData',3);
setToLocalStorageInitial('historyRateData',3);
if(!localStorage["extra"]){
    setToLocalStorageIndvValue('extra',extra);
}

//setToLocalStorageInitial('currentIndexArr',3);
//setToLocalStorageInitial('futureIndexArr',3);

setToLocalStorageInitial('data',9);

var storedData = JSON.parse(localStorage.data);



function getFromLocalStorage(key,arrayPos){
    var temp = localStorage[key];
    if(temp){
        temp = JSON.parse(temp);
        if(arrayPos === -1){
            return  temp;
        }
        return temp[arrayPos];
    }
}

function setUseMyValues(val){
    useMyValues = val ? true : false;
}

function setToLocalStorageIndvValue(key,val){
    localStorage[key] = JSON.stringify(val);
}

function setToLocalStorage(key,arrayPos,val){
    var temp = localStorage[key];
    if(temp){
        temp = JSON.parse(temp);
        temp[arrayPos] = val;
        localStorage[key] = JSON.stringify(temp);
    }
}

function setToLocalStorageInitial(key,amount){
    var temp = localStorage[key];
    if(!temp){
        var tempArr = [];
        for (var i = 0 ; i < amount; i++) {
            tempArr.push("--");
        }
        localStorage[key] = JSON.stringify(tempArr);
    }
}






function calc(){
    total=[0,0,0,0,0,0];
    setValues();
    sumup();
    setPredictionValues();
    decorate();
}

function setMyInterval(val){
    intervalValue = val;
    document.getElementById("intervalValue").textContent= val/1000 ;
    console.log("setMyInterval: val="+val);
    clearInterval(interval);
    interval = setInterval(fetchData, val);
}

function setInitialDataFromLocalStorage(){
    var closeRateArr = getFromLocalStorage('closeRateData',-1);
    var currentRateArr = getFromLocalStorage('currentRateData',-1);
    var historyRateArr = getFromLocalStorage('historyRateData',-1);
    extra = getFromLocalStorage('extra',-1);
    //var currentIndexArr = getFromLocalStorage('currentIndexArr',-1);
    //var futureIndexArr = getFromLocalStorage('futureIndexArr',-1);

    if(closeRateArr[0] !== "--"){document.getElementById('close_sp').innerHTML=closeRateArr[0].toString();}
    if(closeRateArr[1] !== "--"){document.getElementById('close_ndx').innerHTML=closeRateArr[1];}
    if(closeRateArr[2] !== "--"){document.getElementById('close_dax').innerHTML=closeRateArr[2];}

    if(currentRateArr[0] !== "--"){document.getElementById('current_sp_val').innerHTML=currentRateArr[0];}
    if(currentRateArr[1] !== "--"){document.getElementById('current_ndx_val').innerHTML=currentRateArr[1];}
    if(currentRateArr[2] !== "--"){document.getElementById('current_dax_val').innerHTML=currentRateArr[2];}

    if(historyRateArr[0] !== "--"){document.getElementById('his_sp_rate').innerHTML=historyRateArr[0];}
    if(historyRateArr[1] !== "--"){document.getElementById('his_ndx_rate').innerHTML=historyRateArr[1];}
    if(historyRateArr[2] !== "--"){document.getElementById('his_dax_rate').innerHTML=historyRateArr[2];}

    if(storedData[0] !== "--"){document.getElementById('cur_sp_index').innerHTML=storedData[0];}
    if(storedData[1] !== "--"){document.getElementById('cur_ndx_index').innerHTML=storedData[1];}
    if(storedData[2] !== "--"){document.getElementById('cur_dax_index').innerHTML=storedData[2];}

    if(storedData[3] !== "--"){document.getElementById('fut_sp_index').innerHTML=storedData[3];}
    if(storedData[4] !== "--"){document.getElementById('fut_ndx_index').innerHTML=storedData[4];}
    if(storedData[5] !== "--"){document.getElementById('fut_dax_index').innerHTML=storedData[5];}
    document.getElementById('extraMoney').innerHTML=extra;
}

function setTdsListers(){
    document.getElementById('close_sp').addEventListener('input', function(){
        setToLocalStorage('closeRateData',0,document.getElementById('close_sp').innerHTML);
    });
    document.getElementById('close_ndx').addEventListener('input', function(){
        setToLocalStorage('closeRateData',1,document.getElementById('close_ndx').innerHTML);
    });
    document.getElementById('close_dax').addEventListener('input', function(){
        setToLocalStorage('closeRateData',2,document.getElementById('close_dax').innerHTML);
    });

    document.getElementById('his_sp_rate').addEventListener('input', function(){
        setToLocalStorage('historyRateData',0,document.getElementById('his_sp_rate').innerHTML);
    });
    document.getElementById('his_ndx_rate').addEventListener('input', function(){
        setToLocalStorage('historyRateData',1,document.getElementById('his_ndx_rate').innerHTML);
    });
    document.getElementById('his_dax_rate').addEventListener('input', function(){
        setToLocalStorage('historyRateData',2,document.getElementById('his_dax_rate').innerHTML);
    });

    document.getElementById('current_sp_val').addEventListener('input', function(){
        setToLocalStorage('currentRateData',0,document.getElementById('current_sp_val').innerHTML);
    });
    document.getElementById('current_ndx_val').addEventListener('input', function(){
        setToLocalStorage('currentRateData',1,document.getElementById('current_ndx_val').innerHTML);
    });
    document.getElementById('current_dax_val').addEventListener('input', function(){
        setToLocalStorage('currentRateData',2,document.getElementById('current_dax_val').innerHTML);
    });

    document.getElementById('cur_sp_index').addEventListener('input', function(){
        setToLocalStorage('storedData',0,document.getElementById('cur_sp_index').innerHTML);
    });
    document.getElementById('cur_ndx_index').addEventListener('input', function(){
        setToLocalStorage('storedData',1,document.getElementById('cur_ndx_index').innerHTML);
    });
    document.getElementById('cur_dax_index').addEventListener('input', function(){
        setToLocalStorage('storedData',2,document.getElementById('cur_dax_index').innerHTML);
    });

    document.getElementById('fut_sp_index').addEventListener('input', function(){
        setToLocalStorage('data',3,document.getElementById('fut_sp_index').innerHTML);
    });
    document.getElementById('fut_ndx_index').addEventListener('input', function(){
        setToLocalStorage('data',4,document.getElementById('fut_ndx_index').innerHTML);
    });
    document.getElementById('fut_dax_index').addEventListener('input', function(){
        setToLocalStorage('data',5,document.getElementById('fut_dax_index').innerHTML);
    });

    document.getElementById('extraMoney').addEventListener('input', function(){
        extra = parseInt(document.getElementById('extraMoney').innerHTML);
        setToLocalStorageIndvValue('extra',extra);
    });

}

function clearCacheHistoricRate(){
    localStorage.closeRateData = '["--","--","--"]';
    localStorage.historyRateData = '["--","--","--"]';
}


function init(){
    if(initiated){
        return;
    }
    initiated = true;
    setTdsListers();
    setInitialDataFromLocalStorage();
    calc();
    interval = setInterval(fetchData, intervalValue*1000);

}


var TimeZoneID = +"17";window.timezoneOffset = +"10800";window.stream = "https://stream321.forexpros.com:443";
window.uid = 212820187
$(function(){
    $(window).trigger("socketRetry",[["pid-166:","pid-20:","pid-172:","pid-8839:","pid-8874:","pid-8826:","pid-1116194:","pidExt-1116194:","pid-1116195:","pidExt-1116195:","pid-1116196:","pidExt-1116196:","domain-2:"]]);
    console.log("test");
});

function CommaFormatted(amount) {
    amount = amount.toString();
    var delimiter = ","; // replace comma if desired
    var a = amount.split('.',2)
    var d = a[1];
    var i = parseInt(a[0]);
    if(isNaN(i)) { return ''; }
    var minus = '';
    if(i < 0) { minus = '-'; }
    i = Math.abs(i);
    var n = new String(i);
    var a = [];
    while(n.length > 3) {
        var nn = n.substr(n.length-3);
        a.unshift(nn);
        n = n.substr(0,n.length-3);
    }
    if(n.length > 0) { a.unshift(n); }
    n = a.join(delimiter);
    if(!d || d.length < 1) { amount = n; }
    else { amount = n + '.' + d; }
    amount = minus + amount;
    return amount;
}

//console.log("uriya: "+ CommaFormatted("1487834.67"));

function getRawNumber(el, id){
    return parseFloat(el.find(" td:nth-child("+id+")").html().replace(/,/g, '').replace(/₪/g, ''));
}

function getRawNumber2(num){
    return parseFloat(num.replace(/,/g, '').replace(/₪/g, ''));
}

function sumup(){

    $("#myTable tbody tr").each(function() {
        //var value = $(this).find(" td:nth-child(2)").html();
        if($(this).context.rowIndex > 3){
            return;
        }
        $(this).find(" td:nth-child(5)").html(getRawNumber($(this),2) * getRawNumber($(this),4) /100);
        $(this).find(" td:nth-child(6)").html(getRawNumber($(this),3) * getRawNumber($(this),4) /100);
        $(this).find(" td:nth-child(7)").html(getRawNumber($(this),3) / getRawNumber($(this),2) -1);
        $(this).find(" td:nth-child(10)").html(getRawNumber($(this),9) / getRawNumber($(this),8) -1);
        $(this).find(" td:nth-child(11)").html(getRawNumber($(this),10) *3);
        $(this).find(" td:nth-child(12)").html(getRawNumber($(this),11) - getRawNumber($(this),7));
        $(this).find(" td:nth-child(13)").html(getRawNumber($(this),12) * getRawNumber($(this),5));

        total[0] = total[0] + Number(getRawNumber($(this),5));
        total[1] = total[1] + Number(getRawNumber($(this),6));
        total[2] = total[2] + Number(getRawNumber($(this),13));

    });



}

function setValues(){
    $("#myTable tbody tr")[0].cells[8].innerHTML = $("#myTable2 tbody tr")[0].cells[1].innerHTML;
    $("#myTable tbody tr")[1].cells[8].innerHTML = $("#myTable2 tbody tr")[1].cells[1].innerHTML;
    $("#myTable tbody tr")[2].cells[8].innerHTML = $("#myTable2 tbody tr")[2].cells[1].innerHTML;

    if (useMyValues){
        return;
    }

    $("#myTable3 tbody tr")[0].cells[6].innerHTML = $("#myTable tbody tr")[0].cells[2].innerHTML;
    $("#myTable3 tbody tr")[1].cells[6].innerHTML = $("#myTable tbody tr")[1].cells[2].innerHTML;
    $("#myTable3 tbody tr")[2].cells[6].innerHTML = $("#myTable tbody tr")[2].cells[2].innerHTML;

}

function setPredictionValues(){

    $("#myTable3 tbody tr").each(function() {
        if($(this).context.rowIndex > 3){
            return;
        }
        $(this).find(" td:nth-child(4)").html(getRawNumber2($("#myTable2 tbody tr")[$(this).context.rowIndex-1].cells[1].innerHTML) / getRawNumber2($("#myTable2 tbody tr")[$(this).context.rowIndex-1].cells[3].innerHTML)-1);

        //CALC PREDICTION
        $(this).find(" td:nth-child(2)").html(getRawNumber2($("#myTable2 tbody tr")[$(this).context.rowIndex-1].cells[4].innerHTML) * (1 + (getRawNumber2($(this).find(" td:nth-child(4)").html())*3)) );

        $(this).find(" td:nth-child(3)").html(getRawNumber2($(this).find(" td:nth-child(2)").html())* getRawNumber2($("#myTable tbody tr")[$(this).context.rowIndex-1].cells[3].innerHTML) /100 );

        //  $(this).find(" td:nth-child(5)").html((getRawNumber2($(this).find(" td:nth-child(2)").html()) - getRawNumber2($("#myTable2 tbody tr")[$(this).context.rowIndex-1].cells[1].innerHTML))* getRawNumber2($("#myTable tbody tr")[$(this).context.rowIndex-1].cells[3].innerHTML)/100);

        $(this).find(" td:nth-child(6)").html(-1*(1-(getRawNumber2($(this).find(" td:nth-child(3)").html()) / getRawNumber2($("#myTable tbody tr")[$(this).context.rowIndex-1].cells[5].innerHTML))) );

        $(this).find(" td:nth-child(8)").html(getRawNumber2($(this).find(" td:nth-child(7)").html()) * getRawNumber2($("#myTable tbody tr")[$(this).context.rowIndex-1].cells[3].innerHTML) / 100 );

        $(this).find(" td:nth-child(9)").html((getRawNumber2($(this).find(" td:nth-child(7)").html()) - getRawNumber2($(this).find(" td:nth-child(2)").html())) * getRawNumber2($("#myTable tbody tr")[$(this).context.rowIndex-1].cells[3].innerHTML) / 100 );

        total[3] =total[3]+ Number(getRawNumber($(this),3));
        total[4] =total[4]+ Number(getRawNumber($(this),8));
        total[5] =total[5]+ Number(getRawNumber($(this),9));
    });

}

function calcTotal(){
    var row = $("#myTable tbody tr")[3];
    row.cells[4].innerHTML = ("₪"+CommaFormatted(total[0].toFixed().toString()));
    row.cells[5].innerHTML = ("₪"+CommaFormatted(total[1].toFixed().toString()));
    row.cells[6].innerHTML = ((total[1]/total[0]-1)*100).toFixed(2)+"%";
    row.cells[12].innerHTML = ("₪"+CommaFormatted(total[2].toFixed().toString()));

    $("#myTable tbody tr")[4].cells[5].innerHTML = ("₪"+CommaFormatted((extra + total[1]).toFixed().toString()));// gold class
    $("#myTable3 tbody tr")[3].cells[1].innerHTML = ("₪"+CommaFormatted((extra + total[1]).toFixed().toString()));// gold class


    var row2 = $("#myTable3 tbody tr")[3];
    row2.cells[2].innerHTML = ("₪"+CommaFormatted((extra+total[3]).toFixed().toString()));
    row2.cells[7].innerHTML = ("₪"+CommaFormatted((extra+total[4]).toFixed().toString()));
    row2.cells[8].innerHTML = ("₪"+CommaFormatted((total[5]).toFixed().toString()));

}

function decorate(){
    calcTotal();
    $("#myTable tbody tr").each(function() {
        if($(this).context.rowIndex > 3){
            return;
        }

        var value2 = getRawNumber2($(this).find(" td:nth-child(2)").html());
        var value3 = getRawNumber2($(this).find(" td:nth-child(3)").html());
        var value5 = getRawNumber2($(this).find(" td:nth-child(5)").html());
        var value6 = getRawNumber2($(this).find(" td:nth-child(6)").html());
        var value8 = getRawNumber2($(this).find(" td:nth-child(8)").html());
        var value9 = getRawNumber2($(this).find(" td:nth-child(9)").html());
        var value7 = getRawNumber2($(this).find(" td:nth-child(7)").html())*100;
        var value10 = getRawNumber2($(this).find(" td:nth-child(10)").html())*100;
        var value11 = getRawNumber2($(this).find(" td:nth-child(11)").html())*100;
        var value12 = getRawNumber2($(this).find(" td:nth-child(12)").html())*100;
        var value13 = getRawNumber2($(this).find(" td:nth-child(13)").html());

        $(this).find(" td:nth-child(5)").html("₪"+CommaFormatted(Number(value5).toFixed()));
        $(this).find(" td:nth-child(6)").html("₪"+CommaFormatted(Number(value6).toFixed()));
        $(this).find(" td:nth-child(8)").html(CommaFormatted(value8));
        $(this).find(" td:nth-child(9)").html(CommaFormatted(value9));
        $(this).find(" td:nth-child(2)").html(CommaFormatted(value2));
        $(this).find(" td:nth-child(3)").html(CommaFormatted(value3));


        $(this).find(" td:nth-child(7)").html(value7.toFixed(2)+"%");
        $(this).find(" td:nth-child(10)").html(value10.toFixed(2)+"%");
        $(this).find(" td:nth-child(11)").html(value11.toFixed(2)+"%");
        $(this).find(" td:nth-child(12)").html(value12.toFixed(2)+"%");
        $(this).find(" td:nth-child(13)").html("₪"+CommaFormatted(Number(value13).toFixed()));

    });

    $("#myTable3 tbody tr").each(function() {
        if($(this).context.rowIndex > 3){
            return;
        }

        var value2 = getRawNumber2($(this).find(" td:nth-child(2)").html());
        var value3 = getRawNumber2($(this).find(" td:nth-child(3)").html());
        var value4 = getRawNumber2($(this).find(" td:nth-child(4)").html())*100;
        var value5 = getRawNumber2($(this).find(" td:nth-child(5)").html());
        var value6 = getRawNumber2($(this).find(" td:nth-child(6)").html())*100;
        var value7 = getRawNumber2($(this).find(" td:nth-child(7)").html());
        var value8 = getRawNumber2($(this).find(" td:nth-child(8)").html());
        var value9 = getRawNumber2($(this).find(" td:nth-child(9)").html());


        $(this).find(" td:nth-child(2)").html(CommaFormatted(Number(value2).toFixed()));
        $(this).find(" td:nth-child(3)").html("₪"+CommaFormatted(Number(value3).toFixed()));
        $(this).find(" td:nth-child(4)").html(value4.toFixed(2)+"%");
        $(this).find(" td:nth-child(5)").html(CommaFormatted(Number(value5).toFixed()));
        $(this).find(" td:nth-child(6)").html(value6.toFixed(2)+"%");
        $(this).find(" td:nth-child(7)").html(CommaFormatted(Number(value7).toFixed()));
        $(this).find(" td:nth-child(8)").html("₪"+CommaFormatted(Number(value8).toFixed()));
        $(this).find(" td:nth-child(9)").html("₪"+CommaFormatted(Number(value9).toFixed()));




        // $(this).find(" td:nth-child(10)").html(value10.toFixed(2)+"%");
        // $(this).find(" td:nth-child(11)").html(value11.toFixed(2)+"%");
        // $(this).find(" td:nth-child(12)").html(value12.toFixed(2)+"%");
        // $(this).find(" td:nth-child(13)").html(CommaFormatted(Number(value13).toFixed())+"₪");    

    });

}



function fetchData() {
    storedData = JSON.parse(localStorage.data);
    //get the live data
    $("#t1 tbody tr").each(function() {
        liveData[$(this).context.rowIndex-1] = $(this).find(" td:nth-child(2)").html();
    });

    $("#myTable tbody tr").each(function() {
        // kranot data

        if (liveData[$(this).context.rowIndex-1+6] !== "--" ) {
            storedData[$(this).context.rowIndex-1+6] = liveData[$(this).context.rowIndex-1+6];
            $(this).find(" td:nth-child(3)").html(liveData[$(this).context.rowIndex-1+6]) ;
            setToLocalStorage('currentRateData',[$(this).context.rowIndex-1],liveData[$(this).context.rowIndex-1+6]);
        } else {
            //var ans = storedData[$(this).context.rowIndex-1+6];
            var ans = getFromLocalStorage('currentRateData',[$(this).context.rowIndex-1]);
            if (ans !== "--"){
                $(this).find(" td:nth-child(3)").html(ans.toString());
            }
        }
    });

    $("#myTable2 tbody tr").each(function() {

        //future rates data
        if (liveData[$(this).context.rowIndex-1+3] !== "--" ) {
            storedData[$(this).context.rowIndex-1+3] = liveData[$(this).context.rowIndex-1+3];
            $(this).find(" td:nth-child(3)").html(liveData[$(this).context.rowIndex-1+3]) ;
        } else{
            var ans = storedData[$(this).context.rowIndex-1+3];
            if (ans !== "--"){
                $(this).find(" td:nth-child(3)").html(ans);
            }
        }


        // current rates data
        if (liveData[$(this).context.rowIndex-1] !== "--" ) {
            storedData[$(this).context.rowIndex-1] = liveData[$(this).context.rowIndex-1];
            $(this).find(" td:nth-child(2)").html(liveData[$(this).context.rowIndex-1]);
        } else {
            var ans = parseFloat($(this).find(" td:nth-child(3)").html().replace(/,/g, '')) + parseFloat($(this).find(" td:nth-child(7)").html().replace(/,/g, ''));
            if (!isNaN(ans)){
                $(this).find(" td:nth-child(2)").html(CommaFormatted(ans.toString()));
            } else{
                ans = storedData[$(this).context.rowIndex-1];
                if (ans !== "--"){$(this).find(" td:nth-child(2)").html(ans);}

            }
        }


    });

    localStorage.data = JSON.stringify(storedData);
    calc();
}

init();


</script>     
</body>
</html>
